# Serverless-with-API-Gateway-Lambda-and-SQS
"Happy Serverless Trigger"

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/a0e30fe1b50dc289d86f9a7bca792c79b61eaec1/Imagess/Screenshot%202024-12-26%20133713.png)

# Intro

Today we are going serverless with Amazon API Gateway, AWS Lambda and Amazon SQS.

We’ll create Python automation scripts, using the Boto3 library, to interact with AWS services and leverage the seamless integration of AWS’s serverless services.

For those who are not familiar, serverless means being able to run your code without provisioning or managing servers. By using this decoupled architecture of API Gateway, Lambda and SQS, you can take advantage of the benefits of serverless computing, like cost savings, scalability and reduced operational overhead.

# Background

# Amazon API Gateway

Amazon API Gateway is an AWS service used for creating, publishing, maintaining, monitoring and securing REST, HTTP and WebSocket APIs at any scale.

# Boto3

Boto3 provides a Python API for AWS infrastructure services. Using the SDK for Python, you can directly create, update and delete AWS resources using Python scripts.


# AWS Lambda

AWS Lambda is a serverless compute service that runs your code as functions in response to events and automatically manages the underlying compute resources for you.

# Amazon SQS

Amazon SQS is a managed distributed queue system that enables web service applications to queue messages generated by a component in the application to be consumed by another component. The queue acts as a temporary repository for messages that awaiting processing.

# Prerequisites

AWS Account with an IAM User

Basic knowledge of the Python Programming Language

Basic knowledge and use of an Interactive Development Environment (IDE)

AWS CLI installed and configured on local machine

# Overview of steps

These are the steps we will be aiming to accomplish

1.Create a Standard SQS Queue using Python and Boto3

2.Create a Lambda function in the console with a Python 3.7 or higher runtime

3.Modify the Lambda function to send a message that contains the current time to the SQS queue. Test the function using Lambda’s built-in test case

4.Create an HTTP API using API Gateway as a trigger to the Lambda function

5.Test the trigger to verify that the message was sent

# Step 1: Create a Standard SQS Queue using Python.

We will use the Boto3 Python library to create a script to automate the creation of a Standard SQS Queue. The source code is displayed below and can also be viewed or cloned from my GitHub.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/71f6ff4574ce21bc963e7b5c3c31e1a80675583f/Imagess/Screenshot%202024-12-22%20122835.png)


Let’s talk about what is happening in this script.

The first line imports the Boto3 library. The second line of the script creates an SQS resource by passing in the region name as a parameter.

The third line of the script creates a new queue in the SQS service with a custom name “rextech_queue” using the “create_queue” method of the SQS resource.

The fourth line of the script prints out the queue’s attributes, getting the name of the queue and its URL and concatenates them together to form a string.

Now that you understand the script, proceed by running it in your local environment.

If you navigate to your SQS services, you should now be able to see your newly created SQS queue.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/73e7c7f2461aac428c2758f28cb452aedecf225c/Imagess/Screenshot%202024-12-22%20122354.png)

Now that the SQS queue has been created, we can proceed to Step 2— Creating the Lambda function.

# Step 2: Create a Lambda function to send a message to SQS queue

Navigate to the Lambda service in the AWS Management Console and click “Create Function”.

Select “Author from scratch”, name the function, then choose Python 3.7 or greater Runtime. Leave the rest of the settings at default and click “Create function”.


![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/a7b224159fa41aed456c3cb9a7a8410f0cbd7912/Imagess/Screenshot%202024-12-22%20123337.png)


You will then change the default execution role and use an exiting role to give the Lambda function adequate permissions to interact with the SQS service.

To accomplish this, select the “Configuration” tab in your Lambda function’s dashboard, click “Permissions”, then click the current “Role name”.


![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/d0419f64d66f4f9745a95b31432b539aa4499ab1/Imagess/Screenshot%202024-12-26%20135903.png)

A new window should open up. In that new window, select “Add policies”.


![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/4d80226c3190c73d9e568d1a85b43e8d69dff3f7/Imagess/Screenshot%202024-12-22%20123505.png)


Next, type “SQS” in the search box and hit enter. Select the “AmazonSQSFullAccess” role, then click “Add permissions”.

Note — For demonstration purposes we will be use the full access role, however, we should always strive to practice the principle of least privilege, granting only the minimum required permissions needed.


![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/57952aedfbe93fda9717852ce93c57d1a48b124a/Imagess/Screenshot%202024-12-22%20123536.png)

You can now verify that the SQS IAM policy is attached to the Lambda function.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/76bd18aee9a0b5a7de5dc1c89b8317c50ec8311f/Imagess/Screenshot%202024-12-22%20123628.png)


Now that the Lambda function has been created and assigned the necessary permissions, we can proceed to Step 3 — Modifying the Lambda function to send a message to the SQS queue.

# Step 3: Modify the Lambda to send a message to the SQS queue.

In the overview window of the Lambda function, copy and paste the code below into the code tab. You can also view it or clone it from my GitHub repo.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/584e793e1a0c8fd44fca7c7efc686b28ab7ec13c/Imagess/Screenshot%202024-12-22%20124043.png)

Once again, let’s talk about what is happening in this Lambda function.

The code imports the necessary modules, “json” for encoding the response message, “boto3” for accessing the SQS service and “datetime” for getting the current date and time.

The current date and time is obtained using “datetime.now()” and is saved to the variable “current_date_time”.

An SQS resource object is created using the “boto3.resource()” method, with the specified region name.

In the “lambda_handler” function, the SQS queue named “rextech_queue” is obtained using “sqs.get_queue_by_name()”.

The current date and time is obtained from the “current_date_time” variable, then it is formatted to a string type using the “strftime()” method and is saved to the “date_time” variable.

A custom message is created by concatenating a string with the current date and time which is then saved to the “message” variable.

The “send_message()” method is used to send the “message” to the “queue”.

Lastly, the function returns a response with a status code of “200” and the message body, which is a JSON-encoded string of the original message.

Next, click “Deploy” to deploy the function’s code to the Lambda service, then click “Test” to test out the function based on a test case.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/fb34def8c4722940fee9c940ff1a0db597253d70/Imagess/Screenshot%202024-12-22%20124510.png)

For “Test event action”, select “Create a new event”, then name the event. For “Template”, select “apigateway-aws-proxy”

Click “Save” to save the test event.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/88035f389934e61ceb68f710b01779d2378e0009/Imagess/Screenshot%202024-12-22%20124601.png)

We can now test the function by clicking ‘Test”. A response with the status code “200” and body with the message sent to SQS should be displayed in the “Execution results” tab, along with other details from the function execution.


![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/faf8f58f4735c2eae39552470d7ce6ddd1e978d4/Imagess/Screenshot%202024-12-22%20124621.png)


Now that we’ve set up, created and tested our Lambda function successfully, we can now proceed to Step 4— Creating an API gateway HTTP API type to trigger the Lambda function.


# Step 4: Create an HTTP API type and add as a trigger

Click the “Add trigger” button in your “Function overview”.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/edf4c16a6d79c51adfb5e863599d86b33dfc7042/Imagess/Screenshot%202024-12-22%20124724.png)


Select “API Gateway” from the drop down options, select “Create a new API”, then select “HTTP API” for “API type”.

Give your API a name, then click “Add”.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/8a3b2d2aaf479081458a71744d86ab638e3a4f75/Imagess/Screenshot%202024-12-22%20124820.png)


You can now verify that the API Gateway is a valid trigger to the Lambda function.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/5dadd8922af225d897f24929441f3d2a21fbdd4c/Imagess/Screenshot%202024-12-22%20124859.png)


We also need to add another role to give our Lambda function the permissions to interact with the newly created API.

Follow the previous instructions to add a new IAM role, then search for “API Gateway” in the search box. Select “AmazonAPIGatewayAdministrator”, then click “Add permissions”.

Note — For demonstration purposes, we will use the full access role, however, we should always strive to practice the principle of least privilege, granting only the minimum required permission needed.

![image alt](https://github.com/Tatenda-Prince/Serverless-with-API-Gateway-Lambda-and-SQS/blob/d109024f75dd5a32e4f3c9cedeedbb0aaf92bdec/Imagess/Screenshot%202024-12-22%20125002.png)

Now verify that the API Gateway IAM policy is attached to your Lambda function.

![image alt]()

Now that we’ve create a new API and added it as a trigger to our Lambda function, we can now proceed to Step 5— Testing the trigger to verify the message was sent.
























